
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ioterop.github.io/IOWA/Network/">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>IOWA Network environment - IOWA documentation (Lite)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#iowa-network-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://ioterop.github.io/IOWA/" title="IOWA documentation (Lite)" class="md-header-nav__button md-logo" aria-label="IOWA documentation (Lite)">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            IOWA documentation (Lite)
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              IOWA Network environment
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/IOTEROP/IOWA/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ioterop.github.io/IOWA/" title="IOWA documentation (Lite)" class="md-nav__button md-logo" aria-label="IOWA documentation (Lite)">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IOWA documentation (Lite)
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/IOTEROP/IOWA/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../License/" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Changelog/" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LwM2MOverview/" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../EvaluationKit/" class="md-nav__link">
      Evaluation Kit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../AbstractionLayer/" class="md-nav__link">
      Abstraction Layer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CommonAPI/" class="md-nav__link">
      Common APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ClientAPI/" class="md-nav__link">
      Client APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ServerAPI/" class="md-nav__link">
      Server APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../BootstrapServerAPI/" class="md-nav__link">
      Bootstrap Server APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UtilsAPI/" class="md-nav__link">
      Utils APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../DeprecatedAPI/" class="md-nav__link">
      Deprecated APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../OpenSourceLicenses/" class="md-nav__link">
      OpenSource Licenses
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#network-reliability" class="md-nav__link">
    Network reliability
  </a>
  
    <nav class="md-nav" aria-label="Network reliability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#behind-the-transport" class="md-nav__link">
    Behind the transport
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sms-specific-behaviors" class="md-nav__link">
    SMS specific behaviors
  </a>
  
    <nav class="md-nav" aria-label="SMS specific behaviors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#msisdn-fallback" class="md-nav__link">
    MSISDN Fallback
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registration-update-trigger-message" class="md-nav__link">
    Registration Update Trigger message
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#network-reachability" class="md-nav__link">
    Network reachability
  </a>
  
    <nav class="md-nav" aria-label="Network reachability">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#flow" class="md-nav__link">
    Flow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iowa-api" class="md-nav__link">
    IOWA API
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/IOTEROP/IOWA/edit/master/docs/Network.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="iowa-network-environment">IOWA Network environment<a class="headerlink" href="#iowa-network-environment" title="Permanent link">&para;</a></h1>
<h2 id="network-reliability">Network reliability<a class="headerlink" href="#network-reliability" title="Permanent link">&para;</a></h2>
<h3 id="behind-the-transport">Behind the transport<a class="headerlink" href="#behind-the-transport" title="Permanent link">&para;</a></h3>
<p>Network reliability is a real issue when a system is deployed in an environment. Some networks can be reliable, when others do not guarantee the transmission of a message from one side to another.</p>
<p>IOWA supports the following transports:</p>
<ul>
<li>User Datagram Protocol (aka UDP)</li>
<li>Transmission Control Protocol (aka TCP)</li>
<li>LoRaWAN</li>
<li>Short Message Service (aka SMS)</li>
</ul>
<p>For each transport, a set of constants is defined to maximize the chances that message is received. These constants can be simplified into two parts: a retransmission counter and an initial timeout.
The retransmission counter is the number of attempts to send until the communication is considered as failed. The initial timeout is the number of second to wait for a response before resending the message.</p>
<p>The algorithm is as follows: when the initial timeout is triggered and the retransmission counter is less than the maximum retransmission number, the message is retransmitted, the retransmission counter is incremented, and the timeout is doubled. If the retransmission counter reaches the maximum retransmission number on a timeout, then the attempt to transmit the message is canceled and the application process is notified of the failure. On the other hand, if the endpoint receives a response in time, transmission is considered successful.</p>
<p>In IOWA, it means:</p>
<ul>
<li>On server side: when an operation is performed, such as for a LwM2M Server a Read operation, if the message is not received by the client, the callback <a href="../ServerAPI/#iowa_result_callback_t"><code>iowa_result_callback_t</code></a> will be called with <em>status</em> sets to IOWA_COAP_503_SERVICE_UNAVAILABLE.</li>
<li>On client side: if a Confirmable message is not acknowledged by the LwM2M Server such as the registration message, the registration update message, or a confirmable notification, the connection is considered lost. In case of registration or registration update, the callback <a href="../ClientAPI/#iowa_event_callback_t"><code>iowa_event_callback_t</code></a> will be called with <em>eventP-&gt;eventType</em> sets to IOWA_EVENT_REG_FAILED and the function <a href="../CommonAPI/#iowa_step"><code>iowa_step</code></a> will exit by returning IOWA_COAP_503_SERVICE_UNAVAILABLE. On the other hand, if a confirmable notification is not acknowledged, the LwM2M Client deactivates the Server Account until the connection is reestablished, that is, an Acknowledge is received on a Confirmable message.</li>
<li>On both side: if the Platform layer returns a negative value on <a href="../AbstractionLayer/#iowa_system_connection_send"><code>iowa_system_connection_send</code></a>, <a href="../AbstractionLayer/#iowa_system_connection_recv"><code>iowa_system_connection_recv</code></a> or <a href="../AbstractionLayer/#iowa_system_connection_select"><code>iowa_system_connection_select</code></a>, the connection will be considered lost and <a href="../CommonAPI/#iowa_step"><code>iowa_step</code></a> will exit by returning IOWA_COAP_503_SERVICE_UNAVAILABLE.</li>
</ul>
<h3 id="sms-specific-behaviors">SMS specific behaviors<a class="headerlink" href="#sms-specific-behaviors" title="Permanent link">&para;</a></h3>
<h4 id="msisdn-fallback">MSISDN Fallback<a class="headerlink" href="#msisdn-fallback" title="Permanent link">&para;</a></h4>
<p>There is a MSISDN fallback for the Client when the connection can't be established on a Registration message or a Registration Update message is not acknowledged.</p>
<p>This fallback can be activated with the define [<code>IOWA_SMS_SUPPORT</code>][Transports] and by providing the LwM2M Server MSISDN number with <a href="../ClientAPI/#iowa_client_set_server_msisdn"><code>iowa_client_set_server_msisdn</code></a>. In that case, if the LwM2M Client cannot reach a LwM2M Server, IOWA will close the current connection before opening a new SMS connection to try to register with this transport. On this second attempt, if the LwM2M Client has again no response from the LwM2M Server, <a href="../CommonAPI/#iowa_step"><code>iowa_step</code></a> will exit by returning IOWA_COAP_503_SERVICE_UNAVAILABLE.</p>
<p><img alt="MSISDN Fallback" src="../images/msisdn_fallback.png" /></p>
<h4 id="registration-update-trigger-message">Registration Update Trigger message<a class="headerlink" href="#registration-update-trigger-message" title="Permanent link">&para;</a></h4>
<p>On the LwM2M Server side when an operation is not acknowledged by the LwM2M Client, the Server can generate a Registration Update Trigger message with <a href="../ServerAPI/#iowa_server_create_registration_update_trigger_message"><code>iowa_server_create_registration_update_trigger_message</code></a>. This message has to be sent by SMS to the Client.</p>
<p>For this purpose, the Client must at least on its Registration message give its MSISDN number. This MSISDN number can be provided to IOWA when calling <a href="../ClientAPI/#iowa_client_configure"><code>iowa_client_configure</code></a> and setting <em>infoP-&gt;msisdn</em>. Last but not least, the Client has to listen on incoming SMS messages. If a message is received out of bound, the Client has to call <a href="../ClientAPI/#iowa_client_new_incoming_connection"><code>iowa_client_new_incoming_connection</code></a>. If the message received is a Registration Update Trigger, IOWA will automatically sends a Registration Update using the Client preferred binding.</p>
<p><img alt="Registration Update Trigger" src="../images/registration_update_trigger.png" /></p>
<h2 id="network-reachability">Network reachability<a class="headerlink" href="#network-reachability" title="Permanent link">&para;</a></h2>
<p>The LwM2M Server should always be present. But this is not the case for the LwM2M Client. There are multiple reasons for a LwM2M Client not to be available.</p>
<ol>
<li>
<p>A LwM2M Server can deactivate the connection with a LwM2M Client for a certain period. This mechanism can be triggered by executing the resource Disable (ID: 4) of the [<code>Server Object</code>][Server Object]. The LwM2M Server Account will be disabled for a certain period defined in the Disabled Timeout Resource (ID: 5).
After receiving the Execute operation, LwM2M Client must perform the deregistration process, and underlying network connection between the LwM2M Client and LwM2M Server must be disconnected to disable the LwM2M Server account. After the above process, the LwM2M Client must not send any message to the Server and ignore all the messages from the LwM2M Server for the period.
Once the disabled timeout expires, the client restarts the registration process to reconnect to the LwM2M Server.</p>
</li>
<li>
<p>In LwM2M, there is a mechanism called Queue Mode which offers functionality for a LwM2M Client to inform the LwM2M Server that it may be disconnected for an extended period and when it becomes reachable again.
When the LwM2M Client is not reachable, the LwM2M Server does not immediately send downlink requests, but instead waits until the LwM2M Client becomes reachable again.</p>
</li>
</ol>
<h3 id="flow">Flow<a class="headerlink" href="#flow" title="Permanent link">&para;</a></h3>
<p><img alt="Device Management with Queue Mode" src="../images/dm_se_interface_exchanges_queue_mode.png" /></p>
<p>A typical Queue Mode sequence follows the steps listed below:</p>
<ul>
<li>The LwM2M Client registers to the LwM2M Server and requests the LwM2M Server to run in Queue mode.</li>
<li>The LwM2M Client should use the CoAP constant MAX_TRANSMIT_WAIT (93 seconds) to set a timer for how long it shall stay awake after sending a message to the LwM2M Server. After the timeout expires without any messages from the LwM2M Server, the LwM2M Client enters sleep mode.</li>
<li>At some point in time the LwM2M Client wakes up again and transmits a registration update message. Note: During the time the LwM2M Client has been sleeping the IP address assigned to it may have been released and/or existing NAT bindings may have been released. If this is the case, then the client needs to re-run the TLS/DTLS handshake with the LwM2M Server since an IP address and/or port number change will destroy the existing security context.</li>
<li>When the LwM2M Server receives a message from the Client, it determines if any messages need to be sent to the LwM2M Client, as instructed by the Application Server.</li>
</ul>
<h3 id="iowa-api">IOWA API<a class="headerlink" href="#iowa-api" title="Permanent link">&para;</a></h3>
<p>IOWA introduces two APIs to handle the Queue Mode: <a href="../CommonAPI/#iowa_flush_before_pause"><code>iowa_flush_before_pause</code></a> and <a href="../ClientAPI/#iowa_client_send_heartbeat"><code>iowa_client_send_heartbeat</code></a>.</p>
<p><a href="../CommonAPI/#iowa_flush_before_pause"><code>iowa_flush_before_pause</code></a> is used to inform the LwM2M stack that the device will pause. <code>iowa_flush_before_pause()</code> performs all the pending and required operations of the LwM2M stack engine before returning. It means that if the registration lifetime expires during the device sleep, IOWA will send a registration update before returning from this function. When waking up, the LwM2M Client is connected again to the LwM2M Server.
This function also returns a parameter <em>delayP</em> to indicate when the next scheduled IOWA operation is.</p>
<p><a href="../ClientAPI/#iowa_client_send_heartbeat"><code>iowa_client_send_heartbeat</code></a> is used to send an heartbeat message to a LwM2M Server. Depending of the transport, the heartbeat sent can be a CoAP Empty message on LoRaWAN, or a registration update message for others transports.</p>
<p>Below an example in pseudo-code to use these APIs:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&quot;iowa_client.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span>
         <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
    <span class="n">iowa_context_t</span> <span class="n">iowaH</span><span class="p">;</span>
    <span class="n">iowa_status_t</span> <span class="n">result</span><span class="p">;</span>

    <span class="cm">/******************</span>
<span class="cm">     * Initialization</span>
<span class="cm">     */</span>

    <span class="n">iowaH</span> <span class="o">=</span> <span class="n">iowa_init</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>

    <span class="n">iowa_client_configure</span><span class="p">(</span><span class="n">iowaH</span><span class="p">,</span> <span class="s">&quot;IOWA_Sample_QM_Client&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">iowa_client_add_server</span><span class="p">(</span><span class="n">iowaH</span><span class="p">,</span>
                           <span class="mi">1234</span><span class="p">,</span>
                           <span class="s">&quot;coap://localhost:5683&quot;</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span>
                           <span class="mi">0</span><span class="p">,</span>
                           <span class="n">IOWA_SEC_NONE</span><span class="p">);</span>

    <span class="cm">/******************</span>
<span class="cm">     * &quot;Main loop&quot;</span>
<span class="cm">     */</span>

    <span class="k">do</span>
    <span class="p">{</span>
        <span class="kt">uint32_t</span> <span class="n">iowaDelay</span><span class="p">;</span>

        <span class="c1">// Run for 93 seconds</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">iowa_step</span><span class="p">(</span><span class="n">iowaH</span><span class="p">,</span> <span class="mi">93</span><span class="p">);</span>

        <span class="c1">// Prepare to stand by for 60 minutes</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">iowa_flush_before_pause</span><span class="p">(</span><span class="n">iowaH</span><span class="p">,</span> <span class="mi">3600</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iowaDelay</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">iowaDelay</span> <span class="o">&lt;</span> <span class="mi">3600</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">STAND_BY</span><span class="p">(</span><span class="n">iowaDelay</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">STAND_BY</span><span class="p">(</span><span class="mi">3600</span><span class="p">);</span>
            <span class="n">iowa_client_send_heartbeat</span><span class="p">(</span><span class="n">iowaH</span><span class="p">,</span> <span class="mi">1234</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">IOWA_COAP_NO_ERROR</span><span class="p">)</span>

    <span class="n">iowa_client_remove_server</span><span class="p">(</span><span class="n">iowaH</span><span class="p">,</span> <span class="mi">1234</span><span class="p">);</span>
    <span class="n">iowa_close</span><span class="p">(</span><span class="n">iowaH</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>In the above example, after calling <a href="../CommonAPI/#iowa_flush_before_pause"><code>iowa_flush_before_pause</code></a>, there are two possibilities:</p>
<ul>
<li><em>iowaDelay</em> is inferior to the requested stand by time. It means that on next <a href="../CommonAPI/#iowa_step"><code>iowa_step</code></a> call, IOWA will send to the Server a message such as notification, registration update, etc. So, the Server will notice the device wake up and send back any buffered requests.</li>
<li>Or, <em>iowaDelay</em> is equal to the requested stand by time. In that case, IOWA has nothing to send on next iowa_step() turn. To inform the Server that the device is awake, <a href="../ClientAPI/#iowa_client_send_heartbeat"><code>iowa_client_send_heartbeat</code></a> needs to be called.</li>
</ul>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 IoTerop
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://ioterop.com/" target="_blank" rel="noopener" title="Website" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm82.29 357.6c-3.9 3.88-7.99 7.95-11.31 11.28-2.99 3-5.1 6.7-6.17 10.71-1.51 5.66-2.73 11.38-4.77 16.87l-17.39 46.85c-13.76 3-28 4.69-42.65 4.69v-27.38c1.69-12.62-7.64-36.26-22.63-51.25-6-6-9.37-14.14-9.37-22.63v-32.01c0-11.64-6.27-22.34-16.46-27.97-14.37-7.95-34.81-19.06-48.81-26.11-11.48-5.78-22.1-13.14-31.65-21.75l-.8-.72a114.792 114.792 0 01-18.06-20.74c-9.38-13.77-24.66-36.42-34.59-51.14 20.47-45.5 57.36-82.04 103.2-101.89l24.01 12.01C203.48 89.74 216 82.01 216 70.11v-11.3c7.99-1.29 16.12-2.11 24.39-2.42l28.3 28.3c6.25 6.25 6.25 16.38 0 22.63L264 112l-10.34 10.34c-3.12 3.12-3.12 8.19 0 11.31l4.69 4.69c3.12 3.12 3.12 8.19 0 11.31l-8 8a8.008 8.008 0 01-5.66 2.34h-8.99c-2.08 0-4.08.81-5.58 2.27l-9.92 9.65a8.008 8.008 0 00-1.58 9.31l15.59 31.19c2.66 5.32-1.21 11.58-7.15 11.58h-5.64c-1.93 0-3.79-.7-5.24-1.96l-9.28-8.06a16.017 16.017 0 00-15.55-3.1l-31.17 10.39a11.95 11.95 0 00-8.17 11.34c0 4.53 2.56 8.66 6.61 10.69l11.08 5.54c9.41 4.71 19.79 7.16 30.31 7.16s22.59 27.29 32 32h66.75c8.49 0 16.62 3.37 22.63 9.37l13.69 13.69a30.503 30.503 0 018.93 21.57 46.536 46.536 0 01-13.72 32.98zM417 274.25c-5.79-1.45-10.84-5-14.15-9.97l-17.98-26.97a23.97 23.97 0 010-26.62l19.59-29.38c2.32-3.47 5.5-6.29 9.24-8.15l12.98-6.49C440.2 193.59 448 223.87 448 256c0 8.67-.74 17.16-1.82 25.54L417 274.25z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/IOTEROP" target="_blank" rel="noopener" title="GitHub" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
      <a href="https://twitter.com/ioteropcompany" target="_blank" rel="noopener" title="Twitter" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>