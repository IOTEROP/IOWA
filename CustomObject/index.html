
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ioterop.github.io/IOWA/CustomObject/">
      
      
      <link rel="shortcut icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>Custom Object - IOWA documentation (Lite)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#custom-object" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://ioterop.github.io/IOWA/" title="IOWA documentation (Lite)" class="md-header-nav__button md-logo" aria-label="IOWA documentation (Lite)">
      
  <img src="../assets/iowa_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            IOWA documentation (Lite)
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Custom Object
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/IOTEROP/IOWA/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://ioterop.github.io/IOWA/" title="IOWA documentation (Lite)" class="md-nav__button md-logo" aria-label="IOWA documentation (Lite)">
      
  <img src="../assets/iowa_logo.png" alt="logo">

    </a>
    IOWA documentation (Lite)
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/IOTEROP/IOWA/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../License/" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Changelog/" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../LwM2MOverview/" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../EvaluationKit/" class="md-nav__link">
      Evaluation Kit
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../AbstractionLayer/" class="md-nav__link">
      Abstraction Layer
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CommonAPI/" class="md-nav__link">
      Common APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ClientAPI/" class="md-nav__link">
      Client APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../ServerAPI/" class="md-nav__link">
      Server APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../BootstrapServerAPI/" class="md-nav__link">
      Bootstrap Server APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../UtilsAPI/" class="md-nav__link">
      Utils APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../DeprecatedAPI/" class="md-nav__link">
      Deprecated APIs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../OpenSourceLicenses/" class="md-nav__link">
      OpenSource Licenses
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#controlling-a-power-switch" class="md-nav__link">
    Controlling a Power Switch
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#monitoring-the-temperature-during-a-period" class="md-nav__link">
    Monitoring the temperature during a period
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/IOTEROP/IOWA/edit/master/docs/CustomObject.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="custom-object">Custom Object<a class="headerlink" href="#custom-object" title="Permanent link">&para;</a></h1>
<p>IOWA abstracts lot of objects for the LwM2M Client through dedicated API. But additional object can be provided to the stack by using the following functions:</p>
<ul>
<li><a href="../ClientAPI/#iowa_client_add_custom_object"><code>iowa_client_add_custom_object</code></a></li>
<li><a href="../ClientAPI/#iowa_client_remove_custom_object"><code>iowa_client_remove_custom_object</code></a></li>
<li><a href="../ClientAPI/#iowa_client_object_resource_changed"><code>iowa_client_object_resource_changed</code></a></li>
<li><a href="../ClientAPI/#iowa_client_object_instance_changed"><code>iowa_client_object_instance_changed</code></a></li>
</ul>
<p>Below some examples described how to use these APIs to implement your objects.</p>
<h2 id="controlling-a-power-switch">Controlling a Power Switch<a class="headerlink" href="#controlling-a-power-switch" title="Permanent link">&para;</a></h2>
<p>Let’s consider that the device containing the IOWA Client is connected to a power switch. You want to be able to monitor and control this power switch from a LwM2M Server.</p>
<p>The first step is to determine the best layout of the LwM2M Object describing the power switch. Fortunately, the IPSO Alliance defined the Power Control Object (ID: 3312) which suits our needs. By re-using a standardized Object, we do not need to provide the LwM2M Servers with the layout of our Object. A server already knows the Object 3312 which contains the following resources:</p>
<table>
<thead>
<tr>
<th>Resource Name</th>
<th>Resource ID</th>
<th>Access Type</th>
<th>Mandatory</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>On/Off</td>
<td>5850</td>
<td>R, W</td>
<td>Mandatory</td>
<td>Boolean</td>
<td>On/off control, 0=OFF, 1=ON.</td>
</tr>
<tr>
<td>Dimmer</td>
<td>5851</td>
<td>R, W</td>
<td>Optional</td>
<td>Integer</td>
<td>Proportional control, integer value between 0 and 100 as a percentage.</td>
</tr>
<tr>
<td>On Time</td>
<td>5852</td>
<td>R, W</td>
<td>Optional</td>
<td>Integer</td>
<td>The time in seconds that the power relay has been on. Writing a value of 0 resets the counter.</td>
</tr>
<tr>
<td>Cumulative active power</td>
<td>5805</td>
<td>R</td>
<td>Optional</td>
<td>Float</td>
<td>The cumulative active power since the last cumulative energy reset or device start.</td>
</tr>
<tr>
<td>Power factor</td>
<td>5820</td>
<td>R</td>
<td>Optional</td>
<td>Float</td>
<td>The power factor of the load.</td>
</tr>
<tr>
<td>Application Type</td>
<td>5750</td>
<td>R, W</td>
<td>Optional</td>
<td>String</td>
<td>The application type of the sensor or actuator as a string, for instance, "Air Pressure".</td>
</tr>
</tbody>
</table>
<p>The On/Off resource is mandatory to implement and is used to both control and monitor our power switch.</p>
<p>The Dimmer resource is not relevant to our use case. As it is optional, we do not implement it.</p>
<p>The On Time is optional but interesting for this example unlike the Cumulative active power, Power factor and Application Type resources.</p>
<p>To implement this Object in our device, in our main(), after initializing the IOWA context (see above), we declare an array describing the two resources:</p>
<div class="codehilite"><pre><span></span><code><span class="n">iowa_lwm2m_resource_desc_t</span> <span class="n">resources</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
  <span class="p">{</span> <span class="p">{</span><span class="mi">5850</span><span class="p">,</span> <span class="n">IOWA_LWM2M_TYPE_BOOLEAN</span><span class="p">,</span> <span class="n">IOWA_DM_READ</span> <span class="o">|</span> <span class="n">IOWA_DM_WRITE</span><span class="p">,</span> <span class="n">IOWA_RESOURCE_FLAG_MANDATORY</span><span class="p">},</span>
    <span class="p">{</span><span class="mi">5852</span><span class="p">,</span> <span class="n">IOWA_LWM2M_TYPE_INTEGER</span><span class="p">,</span> <span class="n">IOWA_DM_READ</span> <span class="o">|</span> <span class="n">IOWA_DM_WRITE</span><span class="p">,</span> <span class="n">IOWA_RESOURCE_FLAG_OPTIONAL</span><span class="p">}</span> <span class="p">};</span>
</code></pre></div>

<p>Note that the header file "iowa_IPSO_ID.h" in the "include" folder contains defines for the ID, type and operations of the Reusable Resources defined by the IPSO Alliance. Using these macros, we can write the equivalent code as:</p>
<div class="codehilite"><pre><span></span><code><span class="n">iowa_lwm2m_resource_desc_t</span> <span class="n">resources</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
  <span class="p">{</span> <span class="p">{</span><span class="n">IPSO_RSC_ID_ON_OFF</span><span class="p">,</span> <span class="n">IPSO_RSC_TYPE_ON_OFF</span><span class="p">,</span> <span class="n">IPSO_RSC_OP_ON_OFF</span><span class="p">,</span> <span class="n">IOWA_RESOURCE_FLAG_MANDATORY</span><span class="p">},</span>
    <span class="p">{</span><span class="n">IPSO_RSC_ID_ON_TIME</span><span class="p">,</span> <span class="n">IPSO_RSC_TYPE_ON_TIME</span><span class="p">,</span> <span class="n">IPSO_RSC_OP_ON_TIME</span><span class="p">,</span> <span class="n">IOWA_RESOURCE_FLAG_OPTIONAL</span><span class="p">}</span> <span class="p">};</span>
</code></pre></div>

<p>Instance-wise, we only have one power switch to control and it makes no sense that the LwM2M Server could create new instances or delete some and the object does not used resources that can be multiple. The <em>instanceCallback</em> and the <em>resInstanceCallback</em> can be omitted and we declare a single instance with ID 0:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">uint16_t</span> <span class="n">singleInstanceID</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">iowa_client_add_custom_object</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span>
                                       <span class="mi">3312</span><span class="p">,</span>
                                       <span class="mi">1</span><span class="p">,</span> <span class="n">singleInstanceID</span><span class="p">,</span>
                                       <span class="mi">2</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span>
                                       <span class="n">powerSwitchCallback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>Now the Power Control Object is presented to the LwM2M Servers by the IOWA stack.</p>
<p>When a Server performs a command on one of its resources (or the whole Object), the <code>powerSwitchCallback</code> function is called.</p>
<p>Let’s assume our device provides two functions <code>switch_on()</code> and <code>switch_off()</code> to control the power switch and three interruptions to handle:</p>
<ul>
<li><code>SWITCH_ON</code> when the power switch is set to On,</li>
<li><code>SWITCH_OFF</code> when the power switch is set to Off</li>
<li><code>TIMER</code> when a second had elapsed.</li>
</ul>
<p>We first define two global variables to store the power switch state:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">bool</span> <span class="n">switchState</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">onTime</span><span class="p">;</span>
</code></pre></div>

<p>In the interrupt handler, we modify these variables to be in sync with the actual power switch state (pseudo-code):</p>
<div class="codehilite"><pre><span></span><code><span class="k">switch</span> <span class="p">(</span><span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">(...)</span>
<span class="k">case</span> <span class="nl">SWITCH_ON</span><span class="p">:</span>
    <span class="n">switchState</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="nl">SWITCH_OFF</span><span class="p">:</span>
    <span class="n">switchState</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="nl">TIMER</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">switchState</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">onTime</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">(...)</span>
<span class="p">}</span>
</code></pre></div>

<p>Now the <code>powerSwitchCallback</code> function can be implemented:</p>
<div class="codehilite"><pre><span></span><code><span class="n">iowa_status_t</span> <span class="nf">powerSwitchCallback</span><span class="p">(</span><span class="n">iowa_dm_operation_t</span> <span class="n">operation</span><span class="p">,</span>
                                  <span class="n">iowa_lwm2m_data_t</span> <span class="o">*</span><span class="n">dataP</span><span class="p">,</span>
                                  <span class="kt">size_t</span> <span class="n">numData</span><span class="p">,</span>
                                  <span class="kt">void</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span>
                                  <span class="n">iowa_context_t</span> <span class="n">iowaH</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">operation</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">IOWA_DM_READ</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numData</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">resourceID</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="k">case</span> <span class="mi">5850</span><span class="o">:</span>
                <span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">asBoolean</span> <span class="o">=</span> <span class="n">switchState</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="mi">5852</span><span class="o">:</span>
                <span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">asInteger</span> <span class="o">=</span> <span class="n">onTime</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">default</span><span class="o">:</span>
                <span class="c1">// Already handled by IOWA stack</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="nl">IOWA_DM_WRITE</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numData</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">resourceID</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="k">case</span> <span class="mi">5850</span><span class="o">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">asBoolean</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">switch_on</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">switch_off</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="mi">5852</span><span class="o">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">asInteger</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">onTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="n">IOWA_COAP_406_NOT_ACCEPTABLE</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">default</span><span class="o">:</span>
                <span class="c1">// Already handled by IOWA stack</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>

    <span class="k">default</span><span class="o">:</span>
        <span class="c1">// Already handled by IOWA stack</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">IOWA_COAP_NO_ERROR</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Here we assume that the <code>switch_on()</code> and <code>switch_off()</code> functions will trigger an interrupt and the <code>switchState</code> variable is updated by the interrupt handler.</p>
<p>A LwM2M Server can write only <code>0</code> as the new value of the On Time resource hence the check.</p>
<p>If you test this code, you will notice that you can control the power switch remotely and check its state. However the LwM2M Server will not receive notifications when observing the Object resources.</p>
<p>To correct this, we need to inform the IOWA stack of the changes not triggered by a LwM2M Server. This is done by calling the API <a href="../ClientAPI/#iowa_client_object_resource_changed"><code>iowa_client_object_resource_changed()</code></a> whenever a change occurs.</p>
<p>A correct interrupt handler is then:</p>
<div class="codehilite"><pre><span></span><code><span class="k">switch</span> <span class="p">(</span><span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">(...)</span>
<span class="k">case</span> <span class="nl">SWITCH_ON</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">switchState</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">iowa_client_object_resource_changed</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span> <span class="mi">3312</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5850</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">switchState</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="nl">SWITCH_OFF</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">switchState</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">iowa_client_object_resource_changed</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span> <span class="mi">3312</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5850</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">switchState</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="k">break</span><span class="p">;</span>

<span class="k">case</span> <span class="nl">TIMER</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">switchState</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">onTime</span><span class="o">++</span><span class="p">;</span>
        <span class="n">iowa_client_notification_lock</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="n">iowa_client_object_resource_changed</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span> <span class="mi">3312</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5852</span><span class="p">);</span>
        <span class="n">iowa_client_notification_lock</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">(...)</span>
<span class="p">}</span>
</code></pre></div>

<p>Note that the calls to <a href="../ClientAPI/#iowa_client_notification_lock"><code>iowa_client_notification_lock()</code></a> are not necessary but are here as an example.</p>
<p>/clearpage</p>
<h2 id="monitoring-the-temperature-during-a-period">Monitoring the temperature during a period<a class="headerlink" href="#monitoring-the-temperature-during-a-period" title="Permanent link">&para;</a></h2>
<p>Let’s consider that the device containing the IOWA Client is connected to a temperature sensor. You want to be able to monitor this sensor from a LwM2M Server. Monitored value will be reported with the time at which the value was taken.</p>
<p>The following example can be implemented with <a href="../ClientAPI/#iowa_client_IPSO_add_sensor"><code>iowa_client_IPSO_add_sensor</code></a> and <a href="../ClientAPI/#iowa_client_IPSO_update_values"><code>iowa_client_IPSO_update_values</code></a>. But we will instead implement our own Custom Object to understand how monitored values with timestamp can be sent to a LwM2M Server.</p>
<p>The first step is to determine the best layout of the LwM2M Object describing the temperature sensor. Fortunately, the IPSO Alliance defined the Temperature Object (ID: 3303) which suits our needs. By re-using a standardized Object, we do not need to provide the LwM2M Servers with the layout of our Object. A server already knows the Object 3303 which contains the following resources:</p>
<table>
<thead>
<tr>
<th>Resource Name</th>
<th>Resource ID</th>
<th>Access Type</th>
<th>Mandatory</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sensor Value</td>
<td>5700</td>
<td>R</td>
<td>Mandatory</td>
<td>Float</td>
<td>Last or Current Measured Value from the Sensor.</td>
</tr>
<tr>
<td>Min Measured Value</td>
<td>5601</td>
<td>R</td>
<td>Optional</td>
<td>Float</td>
<td>The minimum value measured by the sensor since power ON or reset.</td>
</tr>
<tr>
<td>Max Measured Value</td>
<td>5602</td>
<td>R</td>
<td>Optional</td>
<td>Float</td>
<td>The maximum value measured by the sensor since power ON or reset.</td>
</tr>
<tr>
<td>Min Range Value</td>
<td>5603</td>
<td>R</td>
<td>Optional</td>
<td>Float</td>
<td>The minimum value that can be measured by the sensor.</td>
</tr>
<tr>
<td>Max Range Value</td>
<td>5604</td>
<td>R</td>
<td>Optional</td>
<td>Float</td>
<td>The maximum value that can be measured by the sensor.</td>
</tr>
<tr>
<td>Sensor Units</td>
<td>5701</td>
<td>R</td>
<td>Optional</td>
<td>String</td>
<td>Measurement Units Definition e.g. "Cel" for Temperature in Celsius.</td>
</tr>
<tr>
<td>Reset Min and Max Measured Values</td>
<td>5605</td>
<td>E</td>
<td>Optional</td>
<td></td>
<td>Reset the Min and Max Measured Values to Current Value.</td>
</tr>
</tbody>
</table>
<p>The Sensor Value resource is mandatory to implement and is used to monitor the temperature value.</p>
<p>All the others resources are not relevant to our use case. As they are optional, we do not implement them.</p>
<p>To implement this Object in our device, in our main(), after initializing the IOWA context (see above), we declare an array describing resource:</p>
<div class="codehilite"><pre><span></span><code><span class="n">iowa_lwm2m_resource_desc_t</span> <span class="n">resources</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
  <span class="p">{</span> <span class="p">{</span><span class="mi">5700</span><span class="p">,</span> <span class="n">IOWA_LWM2M_TYPE_FLOAT</span><span class="p">,</span> <span class="n">IOWA_DM_READ</span> <span class="p">,</span> <span class="n">IOWA_RESOURCE_FLAG_MANDATORY</span><span class="p">}</span> <span class="p">};</span>
</code></pre></div>

<p>Note that the header file "iowa_IPSO_ID.h" in the "include" folder contains defines for the ID, type and operations of the Reusable Resources defined by the IPSO Alliance. Using these macros, we can write the equivalent code as:</p>
<div class="codehilite"><pre><span></span><code><span class="n">iowa_lwm2m_resource_desc_t</span> <span class="n">resources</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
  <span class="p">{</span> <span class="p">{</span><span class="n">IPSO_RSC_ID_SENSOR_VALUE</span><span class="p">,</span> <span class="n">IPSO_RSC_TYPE_SENSOR_VALUE</span><span class="p">,</span> <span class="n">IPSO_RSC_OP_SENSOR_VALUE</span><span class="p">,</span> <span class="n">IOWA_RESOURCE_FLAG_MANDATORY</span><span class="p">}</span> <span class="p">};</span>
</code></pre></div>

<p>Instance-wise, we only have one temperature sensor to monitor and it makes no sense that the LwM2M Server could create new instances or delete some and the object does not used resources that can be multiple. The <em>instanceCallback</em> and the <em>resInstanceCallback</em> can be omitted and we declare a single instance with ID 0:</p>
<div class="codehilite"><pre><span></span><code><span class="kt">uint16_t</span> <span class="n">singleInstanceID</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">iowa_client_add_custom_object</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span>
                                       <span class="mi">3303</span><span class="p">,</span>
                                       <span class="mi">1</span><span class="p">,</span> <span class="n">singleInstanceID</span><span class="p">,</span>
                                       <span class="mi">1</span><span class="p">,</span> <span class="n">resources</span><span class="p">,</span>
                                       <span class="n">tempSensorCallback</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
                                       <span class="nb">NULL</span><span class="p">);</span>
</code></pre></div>

<p>Now the Temperature Object is presented to the LwM2M Servers by the IOWA stack.</p>
<p>When a Server performs a command on one of its resources (or the whole Object), the <code>tempSensorCallback</code> function is called.</p>
<p>We want to inform to the LwM2M Server the last values taken with the timestamp associated to each value.</p>
<p>Let’s assume our device provides two functions <code>get_time()</code> and <code>get_temperature()</code> to monitor the temperature value and one interruption to handle:</p>
<ul>
<li><code>NEW_TEMP</code> when a new temperature value is available.</li>
</ul>
<p>We first define a new structure and two global variables to store the temperature values. The temperature values will be stored inside a circular buffer:</p>
<div class="codehilite"><pre><span></span><code><span class="cp">#define NB_VALUE 10</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
    <span class="kt">int32_t</span> <span class="n">timestamp</span><span class="p">;</span>
    <span class="kt">float</span>   <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">temp_value_t</span><span class="p">;</span>

<span class="n">temp_value_t</span> <span class="n">valuesList</span><span class="p">[</span><span class="n">NB_VALUE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<span class="kt">size_t</span> <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div>

<p>In the interrupt handler, we modify these variables to store the temperature values (pseudo-code):</p>
<div class="codehilite"><pre><span></span><code><span class="k">switch</span> <span class="p">(</span><span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">(...)</span>
<span class="k">case</span> <span class="nl">NEW_TEMP</span><span class="p">:</span>
<span class="p">{</span>
    <span class="n">valuesList</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">();</span>
    <span class="n">valuesList</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">get_temperature</span><span class="p">();</span>

    <span class="n">currentIndex</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currentIndex</span> <span class="o">==</span> <span class="n">NB_VALUE</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">(...)</span>
<span class="p">}</span>
</code></pre></div>

<p>Now the <code>tempSensorCallback</code> function can be implemented:</p>
<div class="codehilite"><pre><span></span><code><span class="n">iowa_status_t</span> <span class="nf">tempSensorCallback</span><span class="p">(</span><span class="n">iowa_dm_operation_t</span> <span class="n">operation</span><span class="p">,</span>
                                 <span class="n">iowa_lwm2m_data_t</span> <span class="o">*</span><span class="n">dataP</span><span class="p">,</span>
                                 <span class="kt">size_t</span> <span class="n">numData</span><span class="p">,</span>
                                 <span class="kt">void</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span>
                                 <span class="n">iowa_context_t</span> <span class="n">iowaH</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">iowa_status_t</span> <span class="n">result</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">IOWA_COAP_NO_ERROR</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">operation</span><span class="p">)</span>
    <span class="p">{</span>
    <span class="k">case</span> <span class="nl">IOWA_DM_READ</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numData</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">resourceID</span><span class="p">)</span>
            <span class="p">{</span>
            <span class="k">case</span> <span class="mi">5700</span><span class="o">:</span>
            <span class="p">{</span>
                <span class="c1">// On a Read operation, provides all the timestamp values</span>
                <span class="kt">size_t</span> <span class="n">j</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">valuesList</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// No value added yet</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// Loop on next element</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// Find the latest timestamp not currently added</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">currentIndex</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">currentIndex</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">valuesList</span><span class="p">[</span><span class="n">j</span><span class="mi">-1</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                            <span class="p">{</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">valuesList</span><span class="p">[</span><span class="n">NB_VALUE</span><span class="mi">-1</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">valuesList</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">&lt;</span> <span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="mi">-1</span><span class="p">].</span><span class="n">timestamp</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="n">j</span> <span class="o">=</span> <span class="n">NB_VALUE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="k">else</span>
                        <span class="p">{</span>
                            <span class="n">j</span><span class="o">--</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">.</span><span class="n">asFloat</span> <span class="o">=</span> <span class="n">valuesList</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">value</span><span class="p">;</span>
                <span class="n">dataP</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">valuesList</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">timestamp</span><span class="p">;</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">valuesList</span><span class="p">[</span><span class="n">j</span><span class="mi">-1</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// Changed result to be called again in the callback</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">IOWA_COAP_231_CONTINUE</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">valuesList</span><span class="p">[</span><span class="n">NB_VALUE</span><span class="mi">-1</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="c1">// Changed result to be called again in the callback</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">IOWA_COAP_231_CONTINUE</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">default</span><span class="o">:</span>
                <span class="c1">// Already handled by IOWA stack</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>

    <span class="k">default</span><span class="o">:</span>
        <span class="c1">// Already handled by IOWA stack</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>Pay attention that the timestamp must be absolute and not relative to the current time, means negative values are not accepted. If the timestamp is zero, it's ignored.</p>
<p>If you test this code, you will notice that you can retrieve the current temperature value. However the LwM2M Server will not receive notifications when observing the Object resources.</p>
<p>To correct this, we need to inform the IOWA stack of the changes not triggered by a LwM2M Server. This is done by calling the API <a href="../ClientAPI/#iowa_client_object_resource_changed"><code>iowa_client_object_resource_changed()</code></a> whenever a change occurs.</p>
<p>A correct interrupt handler is then:</p>
<div class="codehilite"><pre><span></span><code><span class="k">switch</span> <span class="p">(</span><span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">(...)</span>
<span class="k">case</span> <span class="nl">NEW_TEMP</span><span class="p">:</span>
<span class="p">{</span>
    <span class="n">valuesList</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">get_time</span><span class="p">();</span>
    <span class="n">valuesList</span><span class="p">[</span><span class="n">currentIndex</span><span class="p">].</span><span class="n">value</span> <span class="o">=</span> <span class="n">get_temperature</span><span class="p">();</span>

    <span class="n">currentIndex</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currentIndex</span> <span class="o">==</span> <span class="n">NB_VALUE</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">currentIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">iowa_client_object_resource_changed</span><span class="p">(</span><span class="n">contextP</span><span class="p">,</span> <span class="mi">3303</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5700</span><span class="p">);</span>
    <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">(...)</span>
<span class="p">}</span>
</code></pre></div>

<p>The diagram of the above example can be:</p>
<p><img alt="Timestamped Notifications" src="../images/timestamped_notifications.png" /></p>
<ul>
<li>The Server sends first an Observation on /3303/0/5700.</li>
<li>At this time the LwM2M Client has only one value to send back, and so the return value of the callback is 0.00 (No Error).</li>
<li>Then the LwM2M Client retrieves the temperature values and call <a href="../ClientAPI/#iowa_client_object_resource_changed"><code>iowa_client_object_resource_changed</code></a> for each new value. The Object callback has the possibility to return multiple values by returning the 2.31 (Continue) code.</li>
</ul>
<p>On first round, the application has to provide the first value, the callback is called with:</p>
<ul>
<li><em>numData</em>: 1</li>
<li><em>dataP[0]</em>:<ul>
<li><em>dataP[0].objectID</em>: 3303, <em>dataP[0].instanceID</em>: 0, <em>dataP[0].resourceID</em>: 5700, <em>dataP[0].resInstanceID</em>: 65535 (IOWA_LWM2M_ID_ALL)</li>
<li><em>dataP[0].type</em>: IOWA_LWM2M_TYPE_FLOAT, <em>dataP[0].value.asFloat</em>: 0.0</li>
<li><em>dataP[0].timestamp</em>: 0</li>
</ul>
</li>
</ul>
<p>On second round, the application has to provide the second value, the callback is called with:</p>
<ul>
<li><em>numData</em>: 2</li>
<li><em>dataP[0]</em>:<ul>
<li><em>dataP[0].objectID</em>: 3303, <em>dataP[0].instanceID</em>: 0, <em>dataP[0].resourceID</em>: 5700, <em>dataP[0].resInstanceID</em>: 65535 (IOWA_LWM2M_ID_ALL)</li>
<li><em>dataP[0].type</em>: IOWA_LWM2M_TYPE_FLOAT, <em>dataP[0].value.asFloat</em>: <strong>FIRST_VALUE</strong></li>
<li><em>dataP[0].timestamp</em>: <strong>FIRST_TIMESTAMP</strong></li>
</ul>
</li>
<li><em>dataP[1]</em>:<ul>
<li><em>dataP[1].objectID</em>: 3303, <em>dataP[1].instanceID</em>: 0, <em>dataP[1].resourceID</em>: 5700, <em>dataP[1].resInstanceID</em>: 65535 (IOWA_LWM2M_ID_ALL)</li>
<li><em>dataP[1].type</em>: IOWA_LWM2M_TYPE_FLOAT, <em>dataP[1].value.asFloat</em>: 0.0</li>
<li><em>dataP[1].timestamp</em>: 0</li>
</ul>
</li>
</ul>
<p>On third round, the application has to provide the third value, the callback is called with:</p>
<ul>
<li><em>numData</em>: 3</li>
<li><em>dataP[0]</em>:<ul>
<li><em>dataP[0].objectID</em>: 3303, <em>dataP[0].instanceID</em>: 0, <em>dataP[0].resourceID</em>: 5700, <em>dataP[0].resInstanceID</em>: 65535 (IOWA_LWM2M_ID_ALL)</li>
<li><em>dataP[0].type</em>: IOWA_LWM2M_TYPE_FLOAT, <em>dataP[0].value.asFloat</em>: <strong>FIRST_VALUE</strong></li>
<li><em>dataP[0].timestamp</em>: <strong>FIRST_TIMESTAMP</strong></li>
</ul>
</li>
<li><em>dataP[1]</em>:<ul>
<li><em>dataP[1].objectID</em>: 3303, <em>dataP[1].instanceID</em>: 0, <em>dataP[1].resourceID</em>: 5700, <em>dataP[1].resInstanceID</em>: 65535 (IOWA_LWM2M_ID_ALL)</li>
<li><em>dataP[1].type</em>: IOWA_LWM2M_TYPE_FLOAT, <em>dataP[1].value.asFloat</em>: <strong>SECOND_VALUE</strong></li>
<li><em>dataP[1].timestamp</em>: <strong>SECOND_TIMESTAMP</strong></li>
</ul>
</li>
<li><em>dataP[2]</em>:<ul>
<li><em>dataP[2].objectID</em>: 3303, <em>dataP[2].instanceID</em>: 0, <em>dataP[2].resourceID</em>: 5700, <em>dataP[2].resInstanceID</em>: 65535 (IOWA_LWM2M_ID_ALL)</li>
<li><em>dataP[2].type</em>: IOWA_LWM2M_TYPE_FLOAT, <em>dataP[2].value.asFloat</em>: 0.0</li>
<li><em>dataP[2].timestamp</em>: 0</li>
</ul>
</li>
</ul>
<p>And so on, until the last value is provided and the return value of the callback is 0.00 (No Error).</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020 IoTerop
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://ioterop.com/" target="_blank" rel="noopener" title="Website" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M248 8C111.03 8 0 119.03 0 256s111.03 248 248 248 248-111.03 248-248S384.97 8 248 8zm82.29 357.6c-3.9 3.88-7.99 7.95-11.31 11.28-2.99 3-5.1 6.7-6.17 10.71-1.51 5.66-2.73 11.38-4.77 16.87l-17.39 46.85c-13.76 3-28 4.69-42.65 4.69v-27.38c1.69-12.62-7.64-36.26-22.63-51.25-6-6-9.37-14.14-9.37-22.63v-32.01c0-11.64-6.27-22.34-16.46-27.97-14.37-7.95-34.81-19.06-48.81-26.11-11.48-5.78-22.1-13.14-31.65-21.75l-.8-.72a114.792 114.792 0 01-18.06-20.74c-9.38-13.77-24.66-36.42-34.59-51.14 20.47-45.5 57.36-82.04 103.2-101.89l24.01 12.01C203.48 89.74 216 82.01 216 70.11v-11.3c7.99-1.29 16.12-2.11 24.39-2.42l28.3 28.3c6.25 6.25 6.25 16.38 0 22.63L264 112l-10.34 10.34c-3.12 3.12-3.12 8.19 0 11.31l4.69 4.69c3.12 3.12 3.12 8.19 0 11.31l-8 8a8.008 8.008 0 01-5.66 2.34h-8.99c-2.08 0-4.08.81-5.58 2.27l-9.92 9.65a8.008 8.008 0 00-1.58 9.31l15.59 31.19c2.66 5.32-1.21 11.58-7.15 11.58h-5.64c-1.93 0-3.79-.7-5.24-1.96l-9.28-8.06a16.017 16.017 0 00-15.55-3.1l-31.17 10.39a11.95 11.95 0 00-8.17 11.34c0 4.53 2.56 8.66 6.61 10.69l11.08 5.54c9.41 4.71 19.79 7.16 30.31 7.16s22.59 27.29 32 32h66.75c8.49 0 16.62 3.37 22.63 9.37l13.69 13.69a30.503 30.503 0 018.93 21.57 46.536 46.536 0 01-13.72 32.98zM417 274.25c-5.79-1.45-10.84-5-14.15-9.97l-17.98-26.97a23.97 23.97 0 010-26.62l19.59-29.38c2.32-3.47 5.5-6.29 9.24-8.15l12.98-6.49C440.2 193.59 448 223.87 448 256c0 8.67-.74 17.16-1.82 25.54L417 274.25z"/></svg>
      </a>
    
      
      
      <a href="https://github.com/IOTEROP" target="_blank" rel="noopener" title="GitHub" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
      <a href="https://twitter.com/ioteropcompany" target="_blank" rel="noopener" title="Twitter" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>